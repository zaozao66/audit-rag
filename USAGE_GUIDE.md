# 阿里云RAG系统使用指南

## 1. 系统概述

本系统是一个基于阿里云text-embedding-v4模型的RAG（检索增强生成）系统，能够处理用户上传的文档并实现智能检索功能。

## 2. 系统架构

```
用户上传文档 (PDF/DOCX/TXT) 
         ↓
    文档解析
         ↓
    文本分块
         ↓
   阿里云API向量化 (text-embedding-v4)
         ↓
    向量存储 (Faiss)
         ↓
    相似性检索
         ↓
    结果返回
```

## 3. 配置说明

### 3.1 API密钥配置

在 `config.json` 中配置阿里云API密钥：

```json
{
  "embedding_model": {
    "provider": "openai",
    "model_name": "text-embedding-v4",
    "api_key": "sk-60bf45825e4442728dc3431b1ffba0bc",  // 替换为你的API密钥
    "endpoint": "https://dashscope.aliyuncs.com/compatible-mode/v1",
    "dimension": 1024
  }
}
```

### 3.2 分块参数

- `chunk_size`: 每个文本块的最大字符数（默认512）
- `overlap`: 相邻块之间的重叠字符数（默认50）

### 3.3 搜索参数

- `top_k`: 返回最相似结果的数量（默认5）
- `similarity_threshold`: 相似度阈值（默认0.5）

## 4. 使用方法

### 4.1 基础使用

```bash
python3 full_aliyun_rag_system.py
```

系统将使用内置示例文档演示功能。

### 4.2 处理用户文档

```bash
python3 full_aliyun_rag_system.py /path/to/doc1.pdf /path/to/doc2.docx /path/to/doc3.txt
```

### 4.3 交互式查询

运行系统后，输入查询内容即可获得相关文档片段。

## 5. 文档格式支持

### 5.1 PDF文档
- 支持文本PDF和扫描PDF（需OCR）
- 自动提取文本内容
- 保留章节结构

### 5.2 DOCX文档
- 支持Word文档格式
- 提取正文、标题、表格内容
- 保持格式信息

### 5.3 TXT文档
- 支持UTF-8编码的纯文本
- 自动检测文件编码
- 保持原始格式

## 6. 输出说明

系统返回的搜索结果包含：

- **相似度分数**: 表示查询与文档的相关性（0-1之间）
- **文档内容**: 匹配的文档片段
- **来源信息**: 原始文档标识

## 7. 性能优化建议

### 7.1 文档预处理
- 对于长文档，建议先进行摘要处理
- 清理无关字符和格式
- 合理设置分块大小

### 7.2 搜索优化
- 调整top_k参数控制返回结果数量
- 设置合适的相似度阈值过滤低质量结果
- 使用精确查询词提高检索准确性

## 8. 故障排除

### 8.1 API调用失败
- 检查API密钥是否正确
- 确认网络连接正常
- 查看API配额是否充足

### 8.2 文档解析错误
- 确认文档格式是否支持
- 检查文档是否损坏
- 验证文件编码是否正确

### 8.3 搜索结果不佳
- 调整分块大小和重叠参数
- 优化查询词表达
- 检查相似度阈值设置

## 9. 安全注意事项

- 妥善保管API密钥，避免泄露
- 定期监控API调用次数和费用
- 敏感文档请谨慎处理

## 10. 扩展功能

- 支持批量文档处理
- 向量库持久化存储
- 自定义搜索算法
- 结果后处理功能