# 法规制度文档分块功能说明

## 概述

RAG系统现在支持专门针对法规制度文档的智能分块功能。该功能能够识别法规文档的层级结构（章节、条款），并按法规条目进行分块，确保每一块内容都对应完整的法规条目，并保留章节上下文信息。

## 功能特点

1. **智能结构识别**：自动识别法规文档中的章节、条款结构
2. **条款完整性**：确保每个法规条目保持完整，不被截断
3. **上下文保留**：为每个文本块添加章节路径信息，便于追溯来源
4. **灵活适配**：支持多种法规文档格式和结构

## 触发机制

系统会自动检测文档是否为法规类文档，检测依据包括：

- 文档中包含法规关键词（如"法"、"条例"、"规定"、"办法"、"章程"、"规则"、"细则"、"制度"等）
- 文档中包含法规结构模式（如"第X章"、"第X条"、"（一）"、"1.2"等形式的标题）

## 使用方法

### 通过API使用法规分块器

#### JSON存储接口

```bash
curl -X POST http://localhost:8000/store \
  -H "Content-Type: application/json" \
  -d '{
    "documents": [
      {
        "doc_id": "doc_1",
        "filename": "regulations.txt",
        "text": "这里是法规文档内容...",
        "source": "example_regulations"
      }
    ],
    "use_law_chunker": true
  }'
```

#### 文件上传接口

```bash
curl -X POST http://localhost:8000/upload_store \
  -F "files=@/path/to/regulations.pdf" \
  -F "use_law_chunker=true" \
  -F "save_after_processing=true"
```

### 参数说明

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| use_law_chunker | Boolean | false | 是否使用法规文档分块器 |

## 分块策略

### 识别的结构模式

系统能够识别以下法规文档结构：

- 章级结构：`第X章 标题`
- 节级结构：`第X节 标题`
- 条级结构：`第X条 内容`
- 数字编号：`1.2.3 标题`
- 中文编号：`（一）标题`、`一、标题`

### 分块原则

1. **完整性原则**：每个法规条目作为一个整体，不被分割
2. **层次性原则**：保留章节层级关系，确保上下文完整
3. **上下文原则**：每个文本块包含其所属章节路径信息

### 输出格式

使用法规分块器后，每个文本块会包含额外的元数据：

```json
{
  "doc_id": "doc_1",
  "filename": "regulations.txt",
  "text": "第一章 总则\n第一条 为规范...\n具体内容...",
  "semantic_boundary": "article",
  "section_path": ["第一章 总则"],
  "header": "第一条 为规范...",
  "char_count": 245
}
```

## 优势

1. **提高检索精度**：按法规条目组织内容，便于精确查找
2. **保持上下文**：保留章节信息，便于理解条款背景
3. **便于引用**：明确的章节路径，便于定位和引用
4. **语义连贯**：完整的法规条目确保语义完整性

## 适用场景

- 法律法规检索系统
- 政策制度问答系统
- 合规管理系统
- 标准规范查询系统

## 注意事项

1. 对于非法规类文档，建议使用标准分块器
2. 法规分块器可能会产生比标准分块器更多但更小的文本块
3. 为确保最佳效果，建议法规文档使用标准的章节结构格式