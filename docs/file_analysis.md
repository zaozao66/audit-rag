# RAG系统 - 文件结构与功能分析

## 项目结构

```
audit-rag/
├── main.py                 # 主程序入口（调用CLI应用）
├── cli_app.py              # 命令行接口应用程序（核心控制器）
├── config.json             # 系统配置文件
├── requirements.txt        # 项目依赖列表
├── README.md               # 项目说明文档
├── USAGE_GUIDE.md          # 详细使用指南
├── start.sh                # 启动脚本
├── src/                    # 源代码目录
│   ├── __init__.py         # 包初始化文件
│   ├── config_loader.py    # 配置加载模块
│   ├── document_chunker.py # 文档分块模块
│   ├── document_processor.py # 文档处理器模块
│   ├── embedding_providers.py # 嵌入提供者模块
│   ├── rag_processor.py    # RAG处理器主模块
│   └── vector_store.py     # 向量存储模块
├── data/                   # 数据目录
│   ├── sample_document.txt # 示例文档（如有）
│   └── vector_store_*      # 向量库文件
└── docs/                   # 文档目录（预留）
```

## 各文件功能详解

### 主程序文件

#### main.py
- **作用**: 程序主入口点，导入并运行CLI应用
- **功能**: 简单的启动器，将控制权交给cli_app.py
- **特点**: 保持最小化，只负责启动CLI应用

#### cli_app.py
- **作用**: 命令行接口应用程序的核心
- **功能**: 
  - 解析命令行参数（store, search, clear）
  - 实现存储文档功能
  - 实现搜索文档功能
  - 实现清空向量库功能
  - 控制整个应用流程
- **特点**: 应用逻辑的中心控制点

### 配置文件

#### config.json
- **作用**: 存储系统配置参数
- **功能**:
  - API密钥配置
  - 嵌入模型配置
  - 文档分块参数配置
  - 搜索参数配置
  - 向量库存储路径配置
- **特点**: 所有可配置参数集中管理

#### requirements.txt
- **作用**: 列出项目依赖包
- **功能**: 定义所需Python包及其版本
- **特点**: 确保环境一致性

### 源代码模块 (src/)

#### config_loader.py
- **作用**: 加载和解析配置文件
- **功能**: 读取config.json并返回配置字典
- **特点**: 配置管理的专门模块

#### document_processor.py
- **作用**: 处理不同格式的文档
- **功能**:
  - 检测文档类型（PDF, DOCX, TXT）
  - 解析不同格式文档内容
  - 返回统一格式的文档对象
- **特点**: 支持多种文档格式的统一接口

#### document_chunker.py
- **作用**: 文档分块处理
- **功能**:
  - 将长文档分割为较小的块
  - 保持语义完整性
  - 处理块之间的重叠
- **特点**: 智能分块算法，适应嵌入模型限制

#### embedding_providers.py
- **作用**: 提供向量嵌入服务
- **功能**:
  - 调用text-embedding-v4 API
  - 处理API请求和响应
  - 返回文本的向量表示
- **特点**: 专门处理嵌入API调用

#### vector_store.py
- **作用**: 向量存储和检索
- **功能**:
  - 使用Faiss进行向量存储
  - 实现向量相似性搜索
  - 支持向量库的保存和加载
- **特点**: 高效的向量相似性搜索

#### rag_processor.py
- **作用**: RAG系统的主要协调者
- **功能**:
  - 协调文档处理流程
  - 管理向量库的生命周期
  - 实现文档存储和搜索功能
  - 支持多文档处理
- **特点**: 核心业务逻辑层

### 数据文件 (data/)

#### 向量库文件 (vector_store_*)
- **作用**: 持久化存储向量和文档映射
- **功能**: 
  - .index文件：Faiss索引数据
  - .docs文件：文档元数据
- **特点**: 支持跨会话的数据持久化

### 文档和脚本

#### README.md
- **作用**: 项目简介和快速入门指南
- **功能**: 提供项目概述和基本使用说明

#### USAGE_GUIDE.md
- **作用**: 详细的使用说明文档
- **功能**: 提供完整功能说明和使用示例

#### start.sh
- **作用**: 便捷的启动脚本
- **功能**: 提供简化的命令行接口

## 系统工作流程

### 存储流程 (store)
1. 解析命令行参数
2. 加载配置
3. 创建嵌入提供者
4. 创建RAG处理器
5. 加载现有向量库（如果存在）
6. 处理文档（解析→分块→嵌入→存储）
7. 保存向量库

### 搜索流程 (search)
1. 解析命令行参数
2. 加载配置
3. 创建嵌入提供者
4. 创建RAG处理器
5. 加载向量库
6. 处理查询（嵌入→搜索→排序）
7. 输出结果

### 清空流程 (clear)
1. 解析命令行参数
2. 创建RAG处理器
3. 加载向量库
4. 清空向量库内容
5. 保存空向量库

## 架构特点

1. **模块化设计**: 各组件职责单一，易于维护
2. **可扩展性**: 易于添加新的文档格式或嵌入提供者
3. **持久化支持**: 支持向量库的保存和加载
4. **命令行友好**: 清晰的命令行接口
5. **错误处理**: 完善的异常处理机制